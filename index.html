<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>详细订单记录管理系统（支持币种自动换算+图片多选）</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }

        body {
            background-color: #f5f7fa;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 15px;
        }

        /* 新增：汇率设置区域样式 */
        .exchange-rate {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .exchange-rate h2 {
            font-size: 18px;
            color: #444;
            margin-bottom: 15px;
        }

        .rate-group {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            min-width: 400px;
        }

        .rate-group label {
            width: 200px;
            color: #555;
            font-weight: 500;
        }

        .rate-group input {
            flex: 1;
            max-width: 200px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            outline: none;
            font-size: 14px;
        }

        .rate-group input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
        }

        .rate-tip {
            color: #666;
            font-size: 12px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
        }

        /* 商品图片库样式 */
        .image-library {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .image-library h2 {
            font-size: 18px;
            color: #444;
            margin-bottom: 15px;
        }

        .upload-area {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px dashed #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .upload-area:hover {
            border-color: #007bff;
        }

        .upload-area input {
            display: none;
        }

        .upload-tip {
            color: #666;
            font-size: 14px;
            margin-top: 10px;
        }

        .img-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 15px;
        }

        .img-item {
            width: 100px;
            height: 100px;
            position: relative;
            border: 2px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
            transition: border-color 0.2s;
        }

        .img-item:hover {
            border-color: #007bff;
        }

        .img-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .img-item .del-img {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            background-color: #dc3545;
            color: #fff;
            border-radius: 50%;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            cursor: pointer;
            display: none;
        }

        .img-item:hover .del-img {
            display: block;
        }

        /* 新增订单表单样式 */
        .add-order {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .add-order h2 {
            font-size: 18px;
            color: #444;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
            min-width: 800px;
        }

        .form-group label {
            width: 160px;
            color: #555;
            font-weight: 500;
            margin-top: 8px;
        }

        .form-group input {
            flex: 1;
            max-width: 400px;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            outline: none;
            font-size: 14px;
        }

        .form-group input:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.2);
        }

        .form-group input[readonly] {
            background-color: #f8f9fa;
            cursor: not-allowed;
        }

        /* 订单图片选择区域样式 */
        .img-select-area {
            flex: 1;
            max-width: 400px;
        }

        .select-img-btn {
            padding: 8px 12px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .select-img-btn:hover {
            background-color: #0069d9;
        }

        .selected-imgs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .selected-img-item {
            width: 60px;
            height: 60px;
            border: 2px solid #007bff;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .selected-img-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .selected-img-item .del-selected {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 16px;
            height: 16px;
            background-color: #dc3545;
            color: #fff;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 10px;
            cursor: pointer;
        }

        /* 图片选择弹窗样式 */
        .img-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 999;
        }

        .img-modal-content {
            background-color: #fff;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 20px;
        }

        .img-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }

        .img-modal-title {
            font-size: 16px;
            color: #333;
            font-weight: 500;
        }

        .close-modal {
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .close-modal:hover {
            color: #dc3545;
        }

        .modal-img-list {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .modal-img-item {
            width: 100px;
            height: 100px;
            position: relative;
            border: 2px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            cursor: pointer;
        }

        .modal-img-item.checked {
            border-color: #007bff;
        }

        .modal-img-item.checked::after {
            content: "✓";
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            background-color: #007bff;
            color: #fff;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            border-radius: 0 0 0 4px;
        }

        .modal-img-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .modal-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .modal-confirm {
            background-color: #007bff;
            color: #fff;
        }

        .modal-cancel {
            background-color: #6c757d;
            color: #fff;
        }

        /* 按钮样式 */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            margin-top: 10px;
        }

        .btn-primary {
            background-color: #007bff;
            color: #fff;
            margin-right: 10px;
        }

        .btn-primary:hover {
            background-color: #0069d9;
        }

        .btn-reset {
            background-color: #6c757d;
            color: #fff;
        }

        .btn-reset:hover {
            background-color: #5a6268;
        }

        /* 订单列表样式 */
        .order-list {
            margin-top: 20px;
            overflow-x: auto;
        }

        .order-list h2 {
            font-size: 18px;
            color: #444;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            text-align: center;
            min-width: 1400px; /* 加宽适配新增的菲律宾比索列 */
        }

        th, td {
            padding: 10px 8px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        th {
            background-color: #007bff;
            color: #fff;
            font-weight: 500;
            white-space: nowrap;
        }

        tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        tr:hover {
            background-color: #e9f5ff;
        }

        .no-order {
            color: #999;
            text-align: center;
            padding: 30px;
            font-size: 16px;
        }

        /* 多张图片展示样式 */
        .order-imgs {
            display: flex;
            gap: 5px;
            justify-content: center;
            align-items: center;
        }

        .order-img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .order-img:hover {
            transform: scale(2);
            z-index: 99;
        }

        /* 利润颜色区分 */
        .profit-positive {
            color: #28a745;
            font-weight: 500;
        }

        .profit-negative {
            color: #dc3545;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>详细订单记录管理系统（支持币种自动换算+图片多选）</h1>

        <!-- 新增：汇率设置区域（泰铢/菲律宾比索兑人民币） -->
        <div class="exchange-rate">
            <h2>当日汇率设置（兑1人民币）</h2>
            <div class="rate-group">
                <label for="thbToCny">1 泰铢 = 多少 人民币：</label>
                <input type="number" id="thbToCny" placeholder="如0.1865" min="0" step="0.0001" value="0.1865" required>
            </div>
            <div class="rate-group">
                <label for="phpToCny">1 菲律宾比索 = 多少 人民币：</label>
                <input type="number" id="phpToCny" placeholder="如0.0125" min="0" step="0.0001" value="0.0125" required>
            </div>
            <p class="rate-tip">提示：1. 汇率请填写当日最新值（保留4位小数）；2. 填写币种金额后，人民币金额会自动换算；3. 汇率修改后，已保存订单不会同步更新，仅对新填写订单生效。</p>
        </div>

        <!-- 商品图片库（上传+存储+展示） -->
        <div class="image-library">
            <h2>商品图片库（上传后可重复选择）</h2>
            <div class="upload-area" onclick="document.getElementById('imgUpload').click()">
                <span>点击上传图片</span>
                <input type="file" id="imgUpload" accept="image/jpg,image/jpeg,image/png,image/gif" multiple>
                <p class="upload-tip">支持jpg、png、gif格式，可批量上传</p>
            </div>
            <div class="img-list" id="imgLibrary"></div>
        </div>

        <!-- 图片选择弹窗 -->
        <div class="img-modal" id="imgModal">
            <div class="img-modal-content">
                <div class="img-modal-header">
                    <div class="img-modal-title">选择商品图片（可多选）</div>
                    <div class="close-modal" onclick="closeImgModal()">×</div>
                </div>
                <div class="modal-img-list" id="modalImgList"></div>
                <div class="modal-footer">
                    <button class="modal-btn modal-cancel" onclick="closeImgModal()">取消</button>
                    <button class="modal-btn modal-confirm" onclick="confirmSelectImgs()">确认选择</button>
                </div>
            </div>
        </div>

        <!-- 新增订单表单（支持币种自动换算+图片多选） -->
        <div class="add-order">
            <h2>新增订单</h2>
            <div class="form-group">
                <label for="orderTime">订单时间：</label>
                <input type="datetime-local" id="orderTime" placeholder="请选择订单时间">
            </div>
            <div class="form-group">
                <label for="orderNum">订单号：</label>
                <input type="text" id="orderNum" placeholder="请输入订单号（如OD20260204001）" required>
            </div>
            <div class="form-group">
                <label for="orderContent">订单内容：</label>
                <input type="text" id="orderContent" placeholder="请输入订单内容（商品详情等）" required>
            </div>
            <!-- 图片选择区域（从图片库多选） -->
            <div class="form-group">
                <label>商品图片：</label>
                <div class="img-select-area">
                    <button class="select-img-btn" onclick="openImgModal()">从图片库选择</button>
                    <div class="selected-imgs" id="selectedImgs"></div>
                </div>
            </div>
            <div class="form-group">
                <label for="goodsPriceCny">商品价格(人民币)：</label>
                <input type="number" id="goodsPriceCny" placeholder="请输入商品价格" min="0" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="firstTripFeeCny">商品头程费用(人民币)：</label>
                <input type="number" id="firstTripFeeCny" placeholder="请输入头程费用" min="0" step="0.01" required>
            </div>
            <!-- 改造：订单金额（泰铢+菲律宾比索+自动换算人民币） -->
            <div class="form-group">
                <label for="orderAmountThb">订单金额(泰铢)：</label>
                <input type="number" id="orderAmountThb" placeholder="请输入订单金额（泰铢）" min="0" step="0.01">
            </div>
            <div class="form-group">
                <label for="orderAmountPhp">订单金额(菲律宾比索)：</label>
                <input type="number" id="orderAmountPhp" placeholder="请输入订单金额（菲律宾比索）" min="0" step="0.01">
            </div>
            <div class="form-group">
                <label for="orderAmountCny">订单金额(人民币)：</label>
                <input type="number" id="orderAmountCny" placeholder="自动换算，无需手动填写" readonly>
            </div>
            <div class="form-group">
                <label for="brushPay">刷单+代付(人民币)：</label>
                <input type="number" id="brushPay" placeholder="请输入刷单+代付金额" min="0" step="0.01" required>
            </div>
            <div class="form-group">
                <label for="shipPriceCny">发货价格(人民币)：</label>
                <input type="number" id="shipPriceCny" placeholder="请输入发货价格" min="0" step="0.01" required>
            </div>
            <!-- 改造：收入金额（泰铢+菲律宾比索+自动换算人民币） -->
            <div class="form-group">
                <label for="incomeAmountThb">收入金额(泰铢)：</label>
                <input type="number" id="incomeAmountThb" placeholder="请输入收入金额（泰铢）" min="0" step="0.01">
            </div>
            <div class="form-group">
                <label for="incomeAmountPhp">收入金额(菲律宾比索)：</label>
                <input type="number" id="incomeAmountPhp" placeholder="请输入收入金额（菲律宾比索）" min="0" step="0.01">
            </div>
            <div class="form-group">
                <label for="incomeAmountCny">收入金额(人民币)：</label>
                <input type="number" id="incomeAmountCny" placeholder="自动换算，无需手动填写" readonly>
            </div>
            <!-- 利润自动计算，无需手动输入 -->
            <div class="form-group">
                <label for="profitCny">利润(人民币)：</label>
                <input type="number" id="profitCny" placeholder="自动计算，无需手动填写" readonly style="background-color: #f8f9fa; cursor: not-allowed;">
            </div>
            <button class="btn btn-primary" onclick="addOrder()">提交订单</button>
            <button class="btn btn-reset" onclick="resetForm()">重置表单</button>
        </div>

        <!-- 订单列表展示（支持币种+多张图片） -->
        <div class="order-list">
            <h2>所有订单记录</h2>
            <table id="orderTable">
                <thead>
                    <tr>
                        <th>订单时间</th>
                        <th>订单号</th>
                        <th>订单内容</th>
                        <th>商品图片</th>
                        <th>商品价格(¥)</th>
                        <th>头程费用(¥)</th>
                        <th>订单金额(泰铢)</th>
                        <th>订单金额(比索)</th>
                        <th>订单金额(¥)</th>
                        <th>刷单+代付(¥)</th>
                        <th>发货价格(¥)</th>
                        <th>收入金额(泰铢)</th>
                        <th>收入金额(比索)</th>
                        <th>收入金额(¥)</th>
                        <th>利润(¥)</th>
                    </tr>
                </thead>
                <tbody id="orderTbody">
                    <!-- 订单数据将通过JS动态插入 -->
                </tbody>
            </table>
            <div class="no-order" id="noOrderTip" style="display: none;">暂无订单记录，快去添加吧！</div>
        </div>
    </div>

    <script>
        // 全局变量：存储已选择的图片Base64数组
        let selectedImgBase64 = [];

        // 1. 页面加载完成后，渲染图片库、订单列表，绑定所有事件
        window.onload = function() {
            renderImageLibrary();
            renderOrderList();
            // 绑定汇率&币种输入事件，实时换算人民币
            bindCurrencyCalculate();
            // 绑定利润计算事件
            bindProfitCalculate();
            // 绑定图片上传事件
            bindImgUpload();
        };

        // 2. 绑定图片上传事件，将本地图片转为Base64并保存
        function bindImgUpload() {
            const imgUpload = document.getElementById("imgUpload");
            imgUpload.addEventListener("change", function(e) {
                const files = e.target.files;
                if (!files.length) return;

                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const reader = new FileReader();

                    reader.onload = function(event) {
                        const imgBase64 = event.target.result;
                        const imgName = file.name;

                        // 从本地存储获取图片库（若无则创建空数组）
                        let imageLibrary = JSON.parse(localStorage.getItem("imageLibrary")) || [];

                        // 避免重复上传相同图片（通过Base64简略对比）
                        const isDuplicate = imageLibrary.some(img => img.base64.substring(0, 100) === imgBase64.substring(0, 100));
                        if (isDuplicate) return;

                        // 添加新图片到图片库数组
                        imageLibrary.push({
                            name: imgName,
                            base64: imgBase64
                        });

                        // 保存更新后的图片库到本地存储
                        localStorage.setItem("imageLibrary", JSON.stringify(imageLibrary));

                        // 重新渲染图片库
                        renderImageLibrary();
                    };

                    // 读取文件为Base64格式
                    reader.readAsDataURL(file);
                }

                // 清空文件选择框，方便重复上传
                imgUpload.value = "";
            });
        }

        // 3. 渲染图片库
        function renderImageLibrary() {
            const imgLibrary = document.getElementById("imgLibrary");
            let imageLibrary = JSON.parse(localStorage.getItem("imageLibrary")) || [];

            // 清空现有图片库
            imgLibrary.innerHTML = "";

            if (imageLibrary.length === 0) {
                imgLibrary.innerHTML = "<p style='color: #999;'>暂无上传图片，快去上传吧！</p>";
                return;
            }

            // 循环插入图片到图片库
            imageLibrary.forEach((img, index) => {
                const imgItem = document.createElement("div");
                imgItem.className = "img-item";
                imgItem.innerHTML = `
                    <img src="${img.base64}" alt="${img.name}">
                    <div class="del-img" onclick="deleteImgFromLibrary(${index})">×</div>
                `;
                imgLibrary.appendChild(imgItem);
            });
        }

        // 4. 从图片库删除单张图片
        function deleteImgFromLibrary(index) {
            if (!confirm("确定要删除这张图片吗？删除后无法恢复！")) return;

            let imageLibrary = JSON.parse(localStorage.getItem("imageLibrary")) || [];

            // 删除指定索引的图片
            imageLibrary.splice(index, 1);

            // 保存更新后的图片库
            localStorage.setItem("imageLibrary", JSON.stringify(imageLibrary));

            // 重新渲染图片库
            renderImageLibrary();
        }

        // 5. 打开图片选择弹窗
        function openImgModal() {
            const imgModal = document.getElementById("imgModal");
            const modalImgList = document.getElementById("modalImgList");
            let imageLibrary = JSON.parse(localStorage.getItem("imageLibrary")) || [];

            // 清空弹窗图片列表
            modalImgList.innerHTML = "";

            if (imageLibrary.length === 0) {
                modalImgList.innerHTML = "<p style='color: #999; text-align: center;'>暂无图片可选，请先上传！</p>";
                imgModal.style.display = "flex";
                return;
            }

            // 循环插入图片到弹窗，支持勾选
            imageLibrary.forEach((img, index) => {
                const modalImgItem = document.createElement("div");
                modalImgItem.className = "modal-img-item";
                modalImgItem.dataset.index = index;
                modalImgItem.dataset.base64 = img.base64;
                modalImgItem.innerHTML = `<img src="${img.base64}" alt="${img.name}">`;

                // 点击勾选/取消勾选
                modalImgItem.addEventListener("click", function() {
                    this.classList.toggle("checked");
                });

                modalImgList.appendChild(modalImgItem);
            });

            // 显示弹窗
            imgModal.style.display = "flex";
        }

        // 6. 关闭图片选择弹窗
        function closeImgModal() {
            const imgModal = document.getElementById("imgModal");
            imgModal.style.display = "none";

            // 清空勾选状态
            const modalImgItems = document.querySelectorAll(".modal-img-item");
            modalImgItems.forEach(item => item.classList.remove("checked"));
        }

        // 7. 确认选择图片，回显到订单表单
        function confirmSelectImgs() {
            const selectedImgs = document.getElementById("selectedImgs");
            const checkedImgItems = document.querySelectorAll(".modal-img-item.checked");

            // 清空已选择图片数组和回显区域
            selectedImgBase64 = [];
            selectedImgs.innerHTML = "";

            if (!checkedImgItems.length) {
                closeImgModal();
                return;
            }

            // 收集已勾选的图片Base64
            checkedImgItems.forEach(item => {
                const imgBase64 = item.dataset.base64;
                selectedImgBase64.push(imgBase64);

                // 回显已选择图片
                const selectedImgItem = document.createElement("div");
                selectedImgItem.className = "selected-img-item";
                selectedImgItem.innerHTML = `
                    <img src="${imgBase64}" alt="已选择图片">
                    <div class="del-selected" onclick="deleteSelectedImg(this, '${imgBase64}')">×</div>
                `;
                selectedImgs.appendChild(selectedImgItem);
            });

            // 关闭弹窗
            closeImgModal();
        }

        // 8. 删除已选择的单张图片
        function deleteSelectedImg(el, imgBase64) {
            // 从已选择数组中删除
            selectedImgBase64 = selectedImgBase64.filter(base64 => base64 !== imgBase64);

            // 从页面中删除
            el.parentElement.remove();
        }

        // 9. 绑定汇率&币种输入事件，实时换算人民币金额
        function bindCurrencyCalculate() {
            // 汇率输入框
            const thbToCny = document.getElementById("thbToCny");
            const phpToCny = document.getElementById("phpToCny");
            // 订单金额币种输入框
            const orderAmountThb = document.getElementById("orderAmountThb");
            const orderAmountPhp = document.getElementById("orderAmountPhp");
            // 收入金额币种输入框
            const incomeAmountThb = document.getElementById("incomeAmountThb");
            const incomeAmountPhp = document.getElementById("incomeAmountPhp");

            // 所有需要触发换算的输入框
            const currencyInputs = [thbToCny, phpToCny, orderAmountThb, orderAmountPhp, incomeAmountThb, incomeAmountPhp];

            // 输入变化时执行换算
            currencyInputs.forEach(field => {
                field.addEventListener("input", function() {
                    calculateOrderCny(); // 换算订单金额人民币
                    calculateIncomeCny(); // 换算收入金额人民币
                });
            });
        }

        // 10. 换算订单金额：泰铢+菲律宾比索 → 人民币
        function calculateOrderCny() {
            const thbToCny = parseFloat(document.getElementById("thbToCny").value) || 0;
            const phpToCny = parseFloat(document.getElementById("phpToCny").value) || 0;
            const orderAmountThb = parseFloat(document.getElementById("orderAmountThb").value) || 0;
            const orderAmountPhp = parseFloat(document.getElementById("orderAmountPhp").value) || 0;

            // 换算公式：订单人民币 = 泰铢金额 × 泰铢兑人民币汇率 + 比索金额 × 比索兑人民币汇率
            const orderCny = (orderAmountThb * thbToCny) + (orderAmountPhp * phpToCny);
            document.getElementById("orderAmountCny").value = orderCny.toFixed(2);
            return orderCny;
        }

        // 11. 换算收入金额：泰铢+菲律宾比索 → 人民币
        function calculateIncomeCny() {
            const thbToCny = parseFloat(document.getElementById("thbToCny").value) || 0;
            const phpToCny = parseFloat(document.getElementById("phpToCny").value) || 0;
            const incomeAmountThb = parseFloat(document.getElementById("incomeAmountThb").value) || 0;
            const incomeAmountPhp = parseFloat(document.getElementById("incomeAmountPhp").value) || 0;

            // 换算公式：收入人民币 = 泰铢金额 × 泰铢兑人民币汇率 + 比索金额 × 比索兑人民币汇率
            const incomeCny = (incomeAmountThb * thbToCny) + (incomeAmountPhp * phpToCny);
            document.getElementById("incomeAmountCny").value = incomeCny.toFixed(2);
            return incomeCny;
        }

        // 12. 绑定金额输入事件，实时自动计算利润
        function bindProfitCalculate() {
            // 所有影响利润的输入框（已包含人民币换算后的字段，无需额外绑定币种）
            const goodsPrice = document.getElementById("goodsPriceCny");
            const firstTripFee = document.getElementById("firstTripFeeCny");
            const brushPay = document.getElementById("brushPay");
            const shipPrice = document.getElementById("shipPriceCny");

            const profitInputs = [goodsPrice, firstTripFee, brushPay, shipPrice];

            profitInputs.forEach(field => {
                field.addEventListener("input", function() {
                    calculateProfit();
                });
            });
        }

        // 13. 计算利润公式：利润 = 收入金额(人民币) - 商品价格 - 头程费用 - 刷单代付 - 发货价格
        function calculateProfit() {
            const incomeCny = calculateIncomeCny(); // 直接调用换算后的收入人民币
            const goodsPrice = parseFloat(document.getElementById("goodsPriceCny").value) || 0;
            const firstTripFee = parseFloat(document.getElementById("firstTripFeeCny").value) || 0;
            const brushPay = parseFloat(document.getElementById("brushPay").value) || 0;
            const shipPrice = parseFloat(document.getElementById("shipPriceCny").value) || 0;

            // 计算利润并保留2位小数
            const profit = incomeCny - goodsPrice - firstTripFee - brushPay - shipPrice;
            document.getElementById("profitCny").value = profit.toFixed(2);
            return profit;
        }

        // 14. 新增订单函数
        function addOrder() {
            // 获取所有表单输入值
            const orderTime = document.getElementById("orderTime").value.trim();
            const orderNum = document.getElementById("orderNum").value.trim();
            const orderContent = document.getElementById("orderContent").value.trim();
            const goodsPriceCny = document.getElementById("goodsPriceCny").value.trim();
            const firstTripFeeCny = document.getElementById("firstTripFeeCny").value.trim();
            // 订单币种金额
            const orderAmountThb = document.getElementById("orderAmountThb").value.trim() || "0.00";
            const orderAmountPhp = document.getElementById("orderAmountPhp").value.trim() || "0.00";
            const orderAmountCny = calculateOrderCny().toFixed(2);
            // 其他成本金额
            const brushPay = document.getElementById("brushPay").value.trim();
            const shipPriceCny = document.getElementById("shipPriceCny").value.trim();
            // 收入币种金额
            const incomeAmountThb = document.getElementById("incomeAmountThb").value.trim() || "0.00";
            const incomeAmountPhp = document.getElementById("incomeAmountPhp").value.trim() || "0.00";
            const incomeAmountCny = calculateIncomeCny().toFixed(2);
            // 利润
            const profitCny = calculateProfit().toFixed(2);
            // 已选择的多张图片
            const orderImgs = [...selectedImgBase64];

            // 表单验证（核心成本字段不能为空，币种金额可填0）
            const requiredFields = [
                orderTime, orderNum, orderContent, goodsPriceCny,
                firstTripFeeCny, brushPay, shipPriceCny
            ];

            if (requiredFields.some(field => !field)) {
                alert("除币种金额和商品图片外，其他成本字段均不能为空，请完整填写！");
                return;
            }

            // 构造完整订单对象（包含新增的菲律宾比索字段）
            const newOrder = {
                orderTime: orderTime,
                orderNum: orderNum,
                orderContent: orderContent,
                orderImgs: orderImgs.length > 0 ? orderImgs : ["https://via.placeholder.com/60?text=无图片"],
                goodsPriceCny: parseFloat(goodsPriceCny).toFixed(2),
                firstTripFeeCny: parseFloat(firstTripFeeCny).toFixed(2),
                orderAmountThb: parseFloat(orderAmountThb).toFixed(2),
                orderAmountPhp: parseFloat(orderAmountPhp).toFixed(2),
                orderAmountCny: orderAmountCny,
                brushPay: parseFloat(brushPay).toFixed(2),
                shipPriceCny: parseFloat(shipPriceCny).toFixed(2),
                incomeAmountThb: parseFloat(incomeAmountThb).toFixed(2),
                incomeAmountPhp: parseFloat(incomeAmountPhp).toFixed(2),
                incomeAmountCny: incomeAmountCny,
                profitCny: profitCny
            };

            // 从本地存储获取现有订单（若无则创建空数组）
            let orderList = JSON.parse(localStorage.getItem("orderList")) || [];

            // 添加新订单到数组
            orderList.push(newOrder);

            // 保存更新后的订单数组到本地存储
            localStorage.setItem("orderList", JSON.stringify(orderList));

            // 重新渲染订单列表
            renderOrderList();

            // 重置表单
            resetForm();

            // 提示添加成功
            alert("订单添加成功！");
        }

        // 15. 渲染订单列表（支持币种+多张图片）
        function renderOrderList() {
            const orderTbody = document.getElementById("orderTbody");
            const noOrderTip = document.getElementById("noOrderTip");

            // 获取本地存储的订单
            let orderList = JSON.parse(localStorage.getItem("orderList")) || [];

            // 清空现有订单列表
            orderTbody.innerHTML = "";

            // 判断是否有订单
            if (orderList.length === 0) {
                noOrderTip.style.display = "block";
                return;
            }

            // 隐藏“暂无订单”提示
            noOrderTip.style.display = "none";

            // 循环插入订单数据到表格
            orderList.forEach(order => {
                const tr = document.createElement("tr");
                // 利润正负色区分
                const profitClass = parseFloat(order.profitCny) >= 0 ? "profit-positive" : "profit-negative";

                // 构造多张图片的HTML
                let imgsHtml = "<div class='order-imgs'>";
                order.orderImgs.forEach(img => {
                    imgsHtml += `<img src="${img}" class="order-img" alt="商品图片">`;
                });
                imgsHtml += "</div>";

                tr.innerHTML = `
                    <td>${order.orderTime}</td>
                    <td>${order.orderNum}</td>
                    <td>${order.orderContent}</td>
                    <td>${imgsHtml}</td>
                    <td>${order.goodsPriceCny}</td>
                    <td>${order.firstTripFeeCny}</td>
                    <td>${order.orderAmountThb}</td>
                    <td>${order.orderAmountPhp}</td>
                    <td>${order.orderAmountCny}</td>
                    <td>${order.brushPay}</td>
                    <td>${order.shipPriceCny}</td>
                    <td>${order.incomeAmountThb}</td>
                    <td>${order.incomeAmountPhp}</td>
                    <td>${order.incomeAmountCny}</td>
                    <td class="${profitClass}">${order.profitCny}</td>
                `;
                orderTbody.appendChild(tr);
            });
        }

        // 16. 重置表单函数
        function resetForm() {
            const allInputs = document.querySelectorAll(".form-group input, .rate-group input");
            allInputs.forEach(input => {
                // 保留汇率默认值，不重置汇率
                if (input.id === "thbToCny") {
                    input.value = "0.1865";
                    return;
                }
                if (input.id === "phpToCny") {
                    input.value = "0.0125";
                    return;
                }
                input.value = "";
            });

            // 重置换算后的人民币和利润输入框
            document.getElementById("orderAmountCny").value = "";
            document.getElementById("incomeAmountCny").value = "";
            document.getElementById("profitCny").value = "";

            // 清空已选择的图片和数组
            selectedImgBase64 = [];
            document.getElementById("selectedImgs").innerHTML = "";
        }
    </script>
</body>
</html>
